# CoinFlip_Flask
#### Video Demo:  https://www.youtube.com/watch?v=XXC2-ulLgO4

### Setup:
Make sure you have the latest version of Python installed as well as Git. Open Git in the directory you'd like the app saved in. 

```
git clone https://github.com/billyroush009/CoinFlip_Flask.git
```

```
pip install -r CoinFlip_Flask/requirements.txt
```

```
python CoinFlip_Flask/main.py
```

Then navigate to "http://127.0.0.1:5000" in your browser to access the running app.

#### Description:
This program is a web application that allows user account creation and login (with simple validation). Once logged in, the user can access the "flip" page which will allow them to guess the result of a coin flip. I utilized the Flask framework similarly to Week 9's project (Finance). The app begins by checking if a registered user is logged in and if not, returns the "login" page with an alert stating to login. To progress into the app the user will have to sign up with their email, username, and password. Once an account is created and logged in, the user will be returned to their home page. The home page displays a table with all of their stats from flipping a coin (will be empty at first login). From home, the user selects the "flip" tab on the navbar to load up the coin flipping page. The coin flip page allows a user to guess "heads" or "tails" then randomly flips a coin with equal chances for either. The result is displayed as an image and with text underneath to verify if your guess was right or wrong. A few stats are kept for the current session of flipping, such as: current streak, highest streak, wins, and loses. Once the user hits the "submit" button the stats from that session are loaded into their homepage's table and then the flip page is reloaded with blank metrics. From the home page you can see all your past stats (per session) and an aggregate stat row on the very bottom. A button placed above the table ("Reset Stats") allows the user to clear out their flip history and start fresh. A "logout" button is also accessible via the nav-bar that allows the user to logout and get back to the original login or sign-up pages.

## main.py:
This is the python file that launches the application. It calls on the "create_app" function from "__init__.py" to return the application then actually runs the app through "app.run(debug=true)". "Debug=true" is an optional parameter used to see active changes done while still coding and could be removed if the application was entirely finished.

## __init__.py:
Naming a file "__init__.py" tells Python that the entire "website" directory should be treated as a package. The SQL database connection and name variables are initialized and then (after importing the appropriate classes from "models.py") used in the function called "create_database" to check and see if the database exists in the app's directory, if not it is created (named "database.db") with no entries and a console message is displayed. All Flask blueprints are imported and registered, which standardize the routes among the application, otherwise all the python and routes would have to be in one file (or imported/referenced in a much more complex way). The "login_manager" from the "flask_login" library then checks the browser cache to see if someone is still logged in and then the app is returned (defaulting to the "/" home path).

## auth.py:
This file contains all the routes to pages and processes that have to do with user login or account creation. It starts with declaring the blueprint variable "auth", referenced in the __init__.py file. It contains the "login" function which is the only way to satisfy the "login_required" parameter blocking all functions in the "views.py" file in this application. "login" collects form information from the login.html page, checks if there are any existing users in the database's "User" table (referencing the email entered) and, if so, checks the entered password's hash from that same databases user's password hash to ensure it is correct. Once the password is confirmed, the user is "logged in" using a function from the "flask_login" library and the homepage is rendered. The "logout" function uses the "logout_user" function from the "flask_login" library to clear the user's info out of the browser cache and then redirects back to the "login" function (which routes back to the login page). The "sign_up" function pulls in email, username, password, and confirmation (for their password) into variables from a form on "sign_up.html", validates them (checks if email is already registered, checks that email is more than 3 characters, checks that the name is more than 1 character, checks that password matches confirmation, and makes sure password is more than 6 characters) with appropriate error flash messages. If all the fields are valid then a User object is created and assigned to a variable with appropriate fields, then added and committed into the database as a new user. The user is logged in (same as within the login function) then redirected to their homepage. 

## views.py:
This file contains all the routes to pages and processes that don't have to do with user login or account creation, primarily dealing with the homepage, coin flip page, and resetting a user's stats. Declares the blueprint variable "views" for use in the __init__.py file. Contains the "home" function ('/' route) that manages the homepage for the app. This function also tallies up the aggregate stats for all the user's flipping sessions to display on the table. The function ends by rendering the "home.html" webpage, passing variables in to fill the bottom aggregate row. Contains the "flip" function, which is used to render and process submissions from the actual coin flip page of the app. Blanketed most the db submission section off with an "if" statement to make sure that at least one coin flip happened, otherwise I was running into an issue dividing by 0. Otherwise, the function pulls in form data and calculates (where necessary) to submit wins, loses, highest streak, and win percentage as a session into the database with the user's id. The "delete_stats" function is used to loop through and delete each of the user's "Flip" entries. Once completed, it renders the homepage with each aggregate value set to "0" to finalize the data reset. 

## models.py:
This file contains the data structures used in the SQLAlchemy database ('Flip' and 'User'). The 'id' field in "User" is the primary key used to relate "Flip" sessions to each user. It's a one-to-many relationship, as one user can have many flip sessions. These structures are used throughout the other python files whenever access to or from the database is required. 

## static folder:
The static folder holds assets that are called in (primarily to html files). The sub-directory "images" holds all the images used on the "flip.html" page, including the question mark placeholder set by default. The "flip.js" file contains all the javascript used on the "flip.html" page. It uses two functions (nextPic and ButtonClick), both of which are called whenever a guess is submitted. nextPic simply generates a number between 1-2 then, depending on the result, loads in a picture of a quarter with heads or tails. ButtonClick is the function that pulls in form data (as well as the user's guess via which button they pressed) then checks if the newly loaded picture is the same as the guess. The nextPic function must run before the ButtonClick function, otherwise the result will reflect whatever picture is currently showing and there wouldn't be much guessing! I used an if/else-if statement to check the user's input against the picture currently loaded, then depending on whether it's correct or wrong will increment wins/losses. Streaks are calculated by incrementing a counter whenever the user guesses right (heads or tails) and then statically setting it to 0 if there's ever a wrong guess. Highest streak is a simple variable checked at the very end of the ButtonClick function, being set equal to the streak counter variable if it is less than it's current value (can only grow larger). "styles.css" is a short external css formatting file that overrides the bootstrap values for a table so the rows are more distinguished and each column is reasonably spaced (very similar to the Finance projects table for holdings)

## templates:
This folder holds all the html files used for the app.
The "base.html" file is the foundation for every other page displayed, it includes bootstrap libraries, the external css sheet, blocks for the title, blocks for the body, the navbar used across the site (with dependencies that reflect whether the user is logged in or not), a block for flash alert messages, and a block for potential scripts. If a user isn't logged in, the only options on the nav bar will be "sign in" or "login", once the user is logged in the options change to "home", "logout", and "flip".

The "sign_up" page contains 4 forms with text inputs and a submit button that routes to the "sign-up" route in "auth.py", flash alerts are displayed on the top of the page (but under the nav bar) and are dismissable with an 'x' icon. 

The "login" page is very similar to the sign_up page, only containing two forms with text fields (for email / password). It submits to the "/login" route in the "auth.py" file and will route to the user's homepage if successful. 

The "home" page displays a header, button, then table with the user's stats for each of their coin flipping sessions. The "reset stats" button here calls the "/delete-stats" route under "views.py" and will clear all the current user's "Flip" objects in "database.db" and the home page will be displayed again. The table is generated using a django for loop within the table generated, looping through and populating each row with each valid attribute to match the headers. The final aggregate row does not come from a database and is calculated on the fly under the "/" route in "views.py", then submitted statically submitted when the homepage is called (each variable assigned). 

The "flip" page contains a title, image, three buttons, and 4 forms (to display data). The image is loaded in as the static "question_mark.png" image to begin and is updated after each "heads" or "tails" button press. Pressing "heads" or "tails" will call the "flip.js" file and, depending which button is pressed, will update the rest of the fields reflecting a correct or incorrect guess (while also generating the resulting flip image). The "submit" button at the bottom of the page is what will actually load that sessions stats into the user's database as a new entry. Once the session is submitted, an alert will prompt at the top of the screen and the flip page will be reloaded with all 0's. 